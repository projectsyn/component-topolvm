apiVersion: apps/v1
kind: DaemonSet
metadata:
  labels:
    app.kubernetes.io/instance: topolvm
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: topolvm
    app.kubernetes.io/version: 0.22.0
    helm.sh/chart: topolvm-12.0.0
    idx: '0'
  name: topolvm-lvmd-0
  namespace: syn-topolvm
spec:
  selector:
    matchLabels:
      app.kubernetes.io/component: lvmd
      app.kubernetes.io/instance: topolvm
      app.kubernetes.io/name: topolvm
      idx: '0'
  template:
    metadata:
      annotations:
        checksum/config: d4121ec47304068d8c8de06a556cb8b732bceaa5e0b56a0f7e1212226ce3d5cb
      labels:
        app.kubernetes.io/component: lvmd
        app.kubernetes.io/instance: topolvm
        app.kubernetes.io/name: topolvm
        idx: '0'
    spec:
      containers:
        - command:
            - /lvmd
            - --container
          image: ghcr.io/topolvm/topolvm-with-sidecar:0.22.0
          imagePullPolicy: IfNotPresent
          livenessProbe:
            exec:
              command:
                - /lvmd
                - health
            initialDelaySeconds: 10
            periodSeconds: 60
            timeoutSeconds: 3
          name: lvmd
          resources:
            limits:
              cpu: 500m
              memory: 500Mi
            requests:
              cpu: 100m
              memory: 100Mi
          securityContext:
            privileged: true
          volumeMounts:
            - mountPath: /etc/topolvm
              name: config
            - mountPath: /run/topolvm
              name: lvmd-socket-dir
      hostPID: true
      nodeSelector:
        syn.tools/topolvm: ''
      serviceAccountName: topolvm-lvmd
      volumes:
        - configMap:
            name: topolvm-lvmd-0
          name: config
        - hostPath:
            path: /run/topolvm
            type: DirectoryOrCreate
          name: lvmd-socket-dir
